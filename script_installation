!#/bin/bash
red='\033[0;31m'

function text () { echo -e "${red}$1"; }

text "Mise à jour du système";
sleep 5
apt update -y
apt upgrade -y
text "Installation de sudo";
sleep 3
apt install sudo -y
text "Ajout de gbehra au groupe sudo";
sleep 3
usermod -aG sudo gbehra
text "Vérification de l'ajout";
sleep 3
getent group sudo
text "Ajout des privilèges à gbehra dans sudoers";
sleep 3
sed -i 's/# User privilege specification/a gbehra	ALL=(ALL) ALL' /etc/sudoers
text "installation de Vim";
sleep 3
apt install vim -y
text "Vérification de la version";
sleep 3
vim --version
text "Installation de openssh-server";
sleep 3
apt install openssh-server -y
text "Vérification";
sleep 3
systemctl status ssh
text "Changement du port 22 en 4242";
sleep 3
sed -i 's/^#\?Port 22$/Port 4242' /etc/ssh/sshd_config
text "Vérification du changement";
sleep 3
grep Port /etc/ssh/sshd_config
text "Redémarrage du service ssh";
sleep 3
service ssh restart
text "Installation de UFW";
sleep 3
apt install ufw -y
text "Activation ufw";
sleep 3
ufw enable
text "Vérification du statut";
sleep 3
ufw status numbered
text "Configuration des ports";
sleep 3
ufw allow ssh
ufw allow 4242
text "Vérification des status";
sleep 3
ufw status numbered
text "Redémarrage ssh";
sleep 3
systemctl restart ssh
text "Vérification du statut";
sleep 3
service sshd status
text "Installation de libpam-pwquality";
sleep 3
apt install libpam-pwquality -y
text "Ajout des règles de mot de passe";
sleep 3
sed -i '/^password.*pam_pwquality.so retry=3/s/$/ minlen=10 ucredit=-1 lcredit=-1 dcredit=-1 maxrepeat=3 reject_username difok=7 enforce_for_root/' /etc/pam.d/common-password
text "Mise en place de règles durée mot de passe";
sleep 3
sed -i 's/^PASS_MAX_DAYS.*/PASS_MAX_DAYS 30/' /etc/login.defs
sed -i 's/^PASS_MIN_DAYS.*/PASS_MIN_DAYS 2/' /etc/login.defs
sed -i 's/^PASS_WARN_AGE.*/PASS_WARN_AGE 7/' /etc/login.defs
text "LA PREMMIERE PARTIE EST FINIE, REBOOT VM PUIS LANCER LE DEUXIEME SCRIPT";