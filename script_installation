#!/bin/bash
red_color='\033[0;31m'

function RED () { echo "${red_color}$1"; }

RED "Mise à jour du système"
sleep 5
apt update -y
apt upgrade -y
RED "Installation de sudo"
sleep 3
apt install sudo -y
RED "Ajout de gbehra au groupe sudo"
sleep 3
usermod -aG sudo gbehra
RED "Vérification de l'ajout"
sleep 3
getent group sudo
RED "Ajout des privilèges à gbehra dans sudoers"
sleep 3
sed -i 's/^# User privilege specification/a gbehra	ALL=(ALL) ALL/' /etc/sudoers
RED "installation de Vim"
sleep 3
apt install vim -y
RED "Vérification de la version"
sleep 3
vim --version
RED "Installation de openssh-server"
sleep 3
apt install openssh-server -y
RED "Vérification"
sleep 3
systemctl status ssh
RED "Changement du port 22 en 4242"
sleep 3
sed -i 's/^#Port 22$/Port 4242/' /etc/ssh/sshd_config
RED "Vérification du changement"
sleep 3
grep Port /etc/ssh/sshd_config
RED "Redémarrage du service ssh"
sleep 3
service ssh restart
RED "Installation de UFW"
sleep 3
apt install ufw -y
RED "Activation ufw"
sleep 3
ufw enable
RED "Vérification du statut"
sleep 3
ufw status numbered
RED "Configuration des ports"
sleep 3
ufw allow ssh
ufw allow 4242
RED "Vérification des status"
sleep 3
ufw status numbered
RED "Redémarrage ssh"
sleep 3
systemctl restart ssh
RED "Vérification du statut"
sleep 3
service sshd status
RED "Installation de libpam-pwquality"
sleep 3
apt install libpam-pwquality -y
RED "Ajout des règles de mot de passe"
sleep 3
sed -i '/^password.*pam_pwquality.so retry=3/s/$/ minlen=10 ucredit=-1 lcredit=-1 dcredit=-1 maxrepeat=3 reject_username difok=7 enforce_for_root/' /etc/pam.d/common-password
RED "Mise en place de règles durée mot de passe"
sleep 3
sed -i 's/^PASS_MAX_DAYS.*/PASS_MAX_DAYS 30/' /etc/login.defs
sed -i 's/^PASS_MIN_DAYS.*/PASS_MIN_DAYS 2/' /etc/login.defs
sed -i 's/^PASS_WARN_AGE.*/PASS_WARN_AGE 7/' /etc/login.defs
RED "LA PREMMIERE PARTIE EST FINIE, REBOOT VM PUIS LANCER LE DEUXIEME SCRIPT"